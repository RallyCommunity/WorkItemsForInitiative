<!DOCTYPE html>
<html>
<head>
    <title>WorkItemsForInitiative</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0rc3/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:[{xtype:"container",id:"headerBox",margin:10,layout:"column",border:5,style:{borderColor:Rally.util.Colors.cyan,borderStyle:"solid"}}],piStr:"",portfolioIds:[],workItems:[],chsrDlg:null,getSettingsFields:function(){var values=[{name:"epicIDs",xtype:"rallytextfield",label:" Space separated list of Portfolio Items to include"}];return _.each(values,function(value){value.labelWidth=250,value.labelAlign="left"}),values},_findAllLowestLevelPIs:function(app){var piList=app.piStr.split(" "),piType=Ext.getCmp("typeSelector").rawValue,piStore=Ext.create("Rally.data.lookback.SnapshotStore",{autoLoad:!0,fetch:["FormattedID","Name","Children"],filters:[{property:"FormattedID",operator:"$in",value:piList},{property:"_TypeHierarchy",value:"PortfolioItem"},{property:"__At",value:"current"}],listeners:{load:function(store,data,success){_.each(data,function(item){})}}})},_doArtifactChooserDialog:function(app){app.chsrDlg&&app.chsrDlg.destroy(),app.chsrDlg=Ext.create("Rally.ui.dialog.SolrArtifactChooserDialog",{artifactTypes:"PortfolioItem/"+Ext.getCmp("typeSelector").rawValue,autoShow:!0,height:400,title:"Choose "+Ext.getCmp("typeSelector").rawValue+" item(s)",multiple:!0,storeConfig:{fetch:["UserStories","Name","FormattedID","TypePath","ObjectID","PortfolioItemType"]},listeners:{artifactchosen:function(dialogBox,selectedRecord){var itmStr="";selectedRecord.forEach(function(record){delim=""===itmStr?"":" ",itmStr+=delim+record.get("FormattedID")}),app.updateSettingsValues({settings:{epicIDs:itmStr}}),app.piStr=itmStr,app._updatePortfolioItemList(app),app._updateDetailsPanes(app)}}})},_piBurnupChart:function(app){},_updateDetailsPanes:function(app){app._findAllLowestLevelPIs(app),app._piBurnupChart(app)},_updatePortfolioItemList:function(app){Ext.getCmp("selectionFromSettings")&&Ext.getCmp("selectionFromSettings").destroy();var txtMsg=Ext.create("Ext.form.field.Text",{fieldLabel:"Current Selected Items",id:"selectionFromSettings",grow:!0,value:app.piStr,border:0,margin:"0 0 0 10",readOnly:!0});Ext.getCmp("headerBox").insert(1,txtMsg)},typeStore:null,launch:function(){var app=this;app.piStr=app.getSetting("epicIDs");var typeSelect=Ext.create("Rally.ui.combobox.PortfolioItemTypeComboBox",{id:"typeSelector",margin:10,listeners:{ready:function(){app.typeStore=Ext.getCmp("typeSelector").store,Ext.getCmp("headerBox").add({xtype:"rallybutton",margin:10,id:"doitButton",text:"Select Item(s)",handler:function(){app._doArtifactChooserDialog(app)}})}}});Ext.getCmp("headerBox").add(typeSelect),app._updatePortfolioItemList(app)}});

            Rally.launchApp('CustomApp', {
                name:"WorkItemsForInitiative",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
